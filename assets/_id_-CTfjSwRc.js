import{bV as k,am as x,a1 as I,a2 as q,al as w,G as F,S as B,X as P,L as a,a4 as s,_ as l,Y as i,V as Q,a5 as n,aR as R,az as $,an as E,a6 as M,bI as N,O as A,ar as D}from"./index-O_OIJZ_k.js";import{c as L,b as O,u as T,e as U,V as j}from"./index.esm-BYzkOkrp.js";import{a as z,V as p,b as f}from"./route-block-XNcMZbMm.js";import{V as G}from"./VDivider-CsSZj-Rn.js";import{V as X}from"./VContainer-BCZ9p7b9.js";const Y={class:"text-center"},H={__name:"[id]",setup(J){const{api:V,apiAuth:b}=D(),_=k(),m=x(),{t:o}=I(),g=q(),v=w(),e=F({_id:"",name:"",price:0,description:"",image:"",sell:!0,category:""});(async()=>{try{const{data:t}=await V.get("/product/"+_.params.id);e.value=t.result,document.title=e.value.name+" | 購物網站"}catch(t){console.log(t),m.push("/"),console.log(2)}})();const h=L({quantity:O().typeError(o("product.addCartQuantityInvalid")).required(o("product.addCartQuantityInvalid")).positive(o("product.addCartQuantityInvalid")).integer(o("product.addCartQuantityInvalid"))}),{handleSubmit:C,isSubmitting:y}=T({validationSchema:h,initialValues:{quantity:1}}),d=U("quantity"),S=C(async t=>{var r,c;if(!g.isLoggedIn){m.push("/login");return}try{const{data:u}=await b.patch("user/cart",{product:e.value._id,quantity:t.quantity});g.cart=u.result,v({text:o("product.addCartSuccess"),snackbarProps:{color:"green"}})}catch(u){console.log(u),v({text:o("api."+(((c=(r=u==null?void 0:u.response)==null?void 0:r.data)==null?void 0:c.message)||"unknownError")),snackbarProps:{color:"red"}})}});return(t,r)=>(B(),P(A,null,[a(X,null,{default:s(()=>[a(z,null,{default:s(()=>[a(p,{cols:"12"},{default:s(()=>[l("h1",Y,i(e.value.name),1)]),_:1}),a(G),a(p,{cols:"12",md:"6"},{default:s(()=>[a(Q,{src:e.value.image},null,8,["src"])]),_:1}),a(p,{cols:"12",md:"6"},{default:s(()=>[l("p",null,i(t.$t("productCategory."+e.value.category)),1),l("p",null,i(e.value.price),1),l("p",null,i(e.value.description),1),a(j,{disabled:n(y),onSubmit:R(n(S),["prevent"])},{default:s(()=>[a($,{modelValue:n(d).value.value,"onUpdate:modelValue":r[0]||(r[0]=c=>n(d).value.value=c),modelModifiers:{number:!0},type:"number","error-messages":n(d).errorMessage.value},null,8,["modelValue","error-messages"]),a(E,{type:"submit","prepend-icon":"mdi-cart",loading:n(y)},{default:s(()=>[M(i(t.$t("product.addCart")),1)]),_:1},8,["loading"])]),_:1},8,["disabled","onSubmit"])]),_:1})]),_:1})]),_:1}),a(N,{"model-value":!e.value.sell,class:"align-center justify-center",scrim:"black",opacity:"0.8",persistent:""},{default:s(()=>r[1]||(r[1]=[l("h1",{class:"text-center"},"已下架",-1)])),_:1},8,["model-value"])],64))}};typeof f=="function"&&f(H);export{H as default};
